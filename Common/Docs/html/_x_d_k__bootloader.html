<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Context-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>XDK API: XDK Bootloader User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
	<div id="header">
		<table class="background-img">
			<tr>
				<td class="left">
					<img src="header_left.jpg" alt="" />
				</td>
				<td class="center">
					<img src="header_center.jpg" alt="" />
				</td>
				<td class="right">
					<img src="header_right.jpg" alt="" />
				</td>
			</tr>
		</table>
	</div>
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="XDK-Main-App-Icon-64.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">XDK API
   &#160;<span id="projectnumber">3.6.0</span>
   </div>
   <div id="projectbrief">Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<html><head></head><body></body></html><!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">XDK Bootloader User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Explains XDKs Bootloader</p>
<hr/>
<p>This page outlines some technical background on as well as the functionality of the XDK bootloader. The XDK bootloader is stored in the first 128 kB of XDKs flash memory. It is write protected and represents the only piece of software on XDK, that shall not be modified by an XDK user. When the bootloader is no longer present or becomes corrupted, an update or recovery is only possible via the J-Link JTAG Adapter (see below).</p>
<h1><a class="anchor" id="XDK_Bootloader_Engage"></a>
How to engage the Bootloader?</h1>
<p>The bootloader can be engaged using the three different approaches.</p>
<p>When clicking the "Flash" button in XDK Workbench, XDK will be automatically brought into bootloader mode. In case XDK is not responding to XDK workbench, a popup will appear. You should now use <a class="el" href="_x_d_k__bootloader.html#XDK_Bootloader_Engage_1">Approach 1</a> to force XDK into bootloader mode.</p>
<h2><a class="anchor" id="XDK_Bootloader_Engage_1"></a>
Approach 1</h2>
<ul>
<li>
Switch off XDK </li>
<li>
Press and hold Button 1 </li>
<li>
Turn on XDK </li>
<li>
Release Button 1 as soon as red LED turns on </li>
</ul>
<p>This approach is the "last resort" when XDK is not responding. Even when XDK is not recognized over USB, approach 1 will still work.</p>
<h2><a class="anchor" id="XDK_Bootloader_Engage_2"></a>
Approach 2</h2>
<ul>
<li>
Get XDK into application mode (typically by switching it on) </li>
<li>
Connect it to your PC </li>
<li>
Start XDK Workbench </li>
<li>
Right click on your XDK in the XDK Device View and select "Goto Bootloader" </li>
</ul>
<p>The second approach will set a flag in the user page of the MCU of XDK. When XDK reboots, the bootloader reads the flag and engages itself. Only after booting an application, the flag is reset.</p>
<h2><a class="anchor" id="XDK_Bootloader_Enageg_3"></a>
Approach 3</h2>
<ul>
<li>
Get XDK into application mode (typically by switching it on) </li>
<li>
Connect it to your PC </li>
<li>
Connect to XDK with a serial terminal program (see XDK_USB_DEVICE_HANDLING_Terminal) </li>
<li>
Send the following string: #reBoot$ </li>
<li>
XDK will automatically reboot and go into the bootloader </li>
</ul>
<p>This is technically the same as <a class="el" href="_x_d_k__bootloader.html#XDK_Bootloader_Engage_2">Approach 2</a>. More information on the commands that can be sent by USB can be found in <a class="el" href="_x_d_k__u_s_b__d_e_v_i_c_e__h_a_n_d_l_i_n_g.html#XDK_USB_DEVICE_HANDLING_RESET_REBOOT">Reset / Reboot XDK</a>.</p>
<h1><a class="anchor" id="XDK_Bootloader_Commands"></a>
Bootloader Commands</h1>
<p>When XDK is in bootloader mode, a serial terminal application (see <a class="el" href="_x_d_k__u_s_b__d_e_v_i_c_e__h_a_n_d_l_i_n_g.html#XDK_USB_DEVICE_HANDLING_Terminal">Using a Serial Terminal</a>) can be used to open up the (virtual) serial port of XDK. The bootloader offers the following commands:</p>
<table class="doxtable">
<tr>
<th>Command </th><th>Meaning </th><th>Explanation </th><th>Commands Supported by bootloader version/versions  </th></tr>
<tr>
<td>u </td><td>Upload application </td><td>This command lets the user upload an application to the flash, while keeping the bootloader intact. For an application to work correctly it must use a linker file which places the application start address at 0x00010000 for the EFM32GG. The application is transferred using the <a href="https://en.wikipedia.org/wiki/XMODEM#XMODEM-CRC">XMODEM-CRC</a> protocol. </td><td>All Bootloader versions </td></tr>
<tr>
<td>i </td><td>Information </td><td>This command returns the bootloader version and unique chip id. </td><td>All Bootloader versions </td></tr>
<tr>
<td>b </td><td>Boot application </td><td>This command will start the uploaded application.</td><td>All Bootloader versions </td></tr>
<tr>
<td>v </td><td>Verify flash checksum </td><td>This command calculates the CRC-16 checksum of the entire flash and prints it.</td><td>All Bootloader versions </td></tr>
<tr>
<td>c </td><td>Verify application checksum </td><td>This command calculates the CRC-16 checksum of the application and prints it. </td><td>All Bootloader versions </td></tr>
<tr>
<td>n </td><td>Verify user page checksum </td><td>This command calculates the CRC-16 checksum of the user page and prints it. </td><td>All Bootloader versions </td></tr>
<tr>
<td>m </td><td>Verify lock page checksum </td><td>This command calculates the CRC-16 checksum of the lock page and prints it. </td><td>All Bootloader versions </td></tr>
<tr>
<td>r </td><td>Reset </td><td>This Command resets the XDK device. </td><td>All Bootloader versions </td></tr>
<tr>
<td>e </td><td>Clean </td><td>This Command clears FOTA User page data and application code area of the flash memory. </td><td>V1.0.0 &amp; above </td></tr>
<tr>
<td>h </td><td>Help Menu </td><td>This Command prints the supported Bootloader commands </td><td>v1.2.0 </td></tr>
<tr>
<td>g </td><td>Read the WLAN MAC address </td><td>This command prints the Wlan MAC address </td><td>All Bootloader versions </td></tr>
<tr>
<td>p </td><td>Lock the bootloader flash area </td><td>This command locks the bootlader flash area </td><td>All Bootloader versions </td></tr>
<tr>
<td>w </td><td>Read the BLE MAC address </td><td>This command prints the ble mac address </td><td>All Bootloader versions </td></tr>
</table>
<p>Binary images uploaded via the bootloader must be transferred in the XMODEM-CRC format.</p>
<h1><a class="anchor" id="XDK_Bootloader_Update"></a>
Bootloader Update</h1>
<p>Updating the bootloader requires a <a href="https://www.segger.com/products/debug-probes/j-link/models/j-link-lite/j-link-lite-cortex-m/">J-Link Lite CortexM-9 JTAG Adapter</a> or <a href="https://www.segger.com/products/debug-probes/j-link/models/j-link-edu-mini/">J-Link EDU Min JTAG Adapter</a> (to be purchased seperately, you can refer to the Bosch XDK device). To perform the update, please follow those steps:</p>
<ul>
<li>
Connect XDK to your PC via USB </li>
<li>
Connect your J-Link adapter to your XDK </li>
<li>
Connect your J-Link adapter to your PC via USB </li>
<li>
Start XDK Workbench </li>
<li>
Make sure, that your XDK shows up as having a JTAG connection </li>
<li>
Right click on XDK, select "Flash Bootloader", a dialog will open. </li>
<li>
Select the binary "XDK110_FOTA_Bootloader_1.1.0.bin" to get FOTA support. </li>
<li>
Select the binary "XDK110_Bootloader_0.0.10.bin" to get support without FOTA . </li>
</ul>
<p>XDK Workbench will update the bootloader and reestablish the write protection for the bootloader section.</p>
<h1><a class="anchor" id="XDK_User_Indication_in_Bootloader_Mode"></a>
User Indication in Bootloader Mode</h1>
<p>The following table indicates LED indications for different scenarios in bootloader mode. </p><table class="doxtable">
<tr>
<th>Case ID </th><th>Yellow </th><th>Orange </th><th>Red </th><th>Scenarios  </th></tr>
<tr>
<td>1 </td><td>OFF </td><td>OFF </td><td>OFF </td><td>In Application/Device Power Off. </td></tr>
<tr>
<td>2 </td><td>OFF </td><td>OFF </td><td>ON </td><td>In Bootloader, USB is enumerated but not connected. </td></tr>
<tr>
<td>3 </td><td>ON </td><td>OFF </td><td>ON </td><td>In Bootloader, USB is enumerated and connected/Recovery failed. </td></tr>
<tr>
<td>4 </td><td>ON </td><td>ON </td><td>ON </td><td>XDK is in Assertion in Application. </td></tr>
<tr>
<td>5 </td><td>Blinking</td><td>OFF </td><td>ON </td><td>New firmware transfer through USB in Bootloader. </td></tr>
<tr>
<td>6 </td><td>OFF </td><td>Blinking</td><td>OFF </td><td>Update of New Firmware in progress. </td></tr>
<tr>
<td>7 </td><td>OFF </td><td>ON </td><td>ON </td><td>FOTA Update Fail. </td></tr>
</table>
<h1><a class="anchor" id="XDK_Firmware_Over_the_Air_Update"></a>
Firmware Over the Air Update</h1>
<p>This section describes Firmware Over the Air Update when the new application is available. </p><ul>
<li>
During the firmware over the air update, the application requires the SD card to keep the new application which is downloaded over FOTA. </li>
<li>
When the new firmware is available for update the application will intimate the bootloader by trigger and switches to bootloader mode. </li>
<li>
During this process user will be having an LED indication as in case (6). </li>
<li>
In case the firmware upgrade fails and the existing application is intact the Bootloader will jump to current application and will be indicated by LED as in case (7). </li>
<li>
In case of existing application is corrupted and backup fails then USB communication is enabled to flash the application over USB and will be indicated by LED as in case (3). </li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>USB communication will not be available when the device is in scenario "Update of New Firmware in progress using FOTA" as in case(6), after successful update the application will enable USB communication.</li>
<li>User must not try to initiate any trigger from workbench when the device is in scenario Update of New Firmware in progress using FOTA as in case(6).</li>
<li>Maximum supported binary size for user application see section <a class="el" href="_x_d_k__bootloader.html#XDK_BOOTLOADER_ERRATA">Bootloader-Application Partition information</a></li>
<li>Case (6) is the only user indication currently supported to notify user that the boot loader is uploading new firmware received using FOTA.</li>
<li>When in bootloader mode and button 2 is pressed the bootloader will jump to appplication mode</li>
</ol>
</dd></dl>
<h1><a class="anchor" id="XDK_BOOTLOADER_ERRATA"></a>
Bootloader-Application Partition information</h1>
<p>This section describes how the microcontroller flash memory address space is separated for bootloader area and user application area</p>
<table class="doxtable">
<tr>
<th>Bootloader Version No </th><th>Flash Memory </th><th>Bootloader Memory</th><th>Application Memory </th><th>Reserved Memory </th><th>Description  </th></tr>
<tr>
<td>V0.0.11 &amp; below </td><td>1024KB </td><td>64KB </td><td>960 KB </td><td>NULL </td><td>No Restriction </td></tr>
<tr>
<td>V1.0.0 &amp; V1.1.0 </td><td>1024KB </td><td>128KB </td><td>600 KB (896KB J-Link) </td><td>296KB </td><td>Application memory restriction of 600KB is only valid by flashing over USB not with J-Link or FOTA </td></tr>
<tr>
<td>V1.2.0 </td><td>1024KB </td><td>128KB </td><td>896KB </td><td>NULL </td><td>No Restriction </td></tr>
</table>
</div></div><!-- contents -->
	<hr size="1" />
	All rights reserved. The use is subject to the XDK SDK EULA by Bosch Connected Devices and Solutions GmbH. 
	<hr size="1" />
	<address style="align: right;">
		<small>This documentation file has been automatically generated on Thu Mar 14 2019 19:12:49 by <a href="http://www.doxygen.org/index.html">doxygen</a> 1.8.8</small>
	</address>
</body>
</html>