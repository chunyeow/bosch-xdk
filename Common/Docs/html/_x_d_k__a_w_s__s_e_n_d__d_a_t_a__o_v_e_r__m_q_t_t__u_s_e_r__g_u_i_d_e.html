<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Context-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>XDK API: XDK AwsSendDataOverMQTT Application User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
	<div id="header">
		<table class="background-img">
			<tr>
				<td class="left">
					<img src="header_left.jpg" alt="" />
				</td>
				<td class="center">
					<img src="header_center.jpg" alt="" />
				</td>
				<td class="right">
					<img src="header_right.jpg" alt="" />
				</td>
			</tr>
		</table>
	</div>
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="XDK-Main-App-Icon-64.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">XDK API
   &#160;<span id="projectnumber">3.6.0</span>
   </div>
   <div id="projectbrief">Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<html><head></head><body></body></html><!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">XDK AwsSendDataOverMQTT Application User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>XDK AwsSendDataOverMQTT application shows how to use the MQTT protocol to transfer the sensor data to an AWS server using Amazon FreeRTOS.</p>
<h1><a class="anchor" id="XDK_AWS_SEND_DATA_OVER_MQTT_USER_GUIDE_USAGE"></a>
XDK AwsSendDataOverMQTT Application User Guide</h1>
<hr/>
<ol type="1">
<li>Find the files placed under AwsSendDataOverMQTT(4 files) <div class="fragment"><div class="line">config.txt – Configuration <a class="code" href="_b_l_e_s_w-_a_l_p_w_data_exchange_01_release_notes_8txt.html#ac483df48653e4a0d787de0c45a6755b6">file</a></div>
<div class="line">rootCA.der – Root Certificate</div>
<div class="line">xdk-cert.der - A certificate <span class="keywordflow">for</span> <span class="keyword">this</span> thing</div>
<div class="line">xdk-priv.der – Private Certificate</div>
</div><!-- fragment --></li>
<li>Modify the config.txt with ssid, password , serverurl, serverport , brokerurl and broker port as shown below in config.txt. <dl class="section note"><dt>Note</dt><dd>brokerurl - Go to IoT core available under Internet of Things of Home page after logging into <a href="http://console.aws.amazon.com/">http://console.aws.amazon.com/</a> brokerurl you can get from Settings under Endpoint <div class="fragment"><div class="line">          {</div>
<div class="line">    <span class="stringliteral">&quot;wlan&quot;</span>:</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;isenterprise&quot;</span> : 0,</div>
<div class="line">        <span class="stringliteral">&quot;ishostpgmenabled&quot;</span> : 0,</div>
<div class="line">        <span class="stringliteral">&quot;ssid&quot;</span> : <span class="stringliteral">&quot;xxxxx&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;username&quot;</span> : <span class="stringliteral">&quot;xxxxx&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;password&quot;</span> : <span class="stringliteral">&quot;xxxxx&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;isstatic&quot;</span> : 0,</div>
<div class="line">        <span class="stringliteral">&quot;ipaddr&quot;</span> : <span class="stringliteral">&quot;0.0.0.0&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;gwaddr&quot;</span> : <span class="stringliteral">&quot;0.0.0.0&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;dnsaddr&quot;</span> : <span class="stringliteral">&quot;0.0.0.0&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;mask&quot;</span> : <span class="stringliteral">&quot;0.0.0.0&quot;</span></div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;sntp&quot;</span>:</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;serverurl&quot;</span>: <span class="stringliteral">&quot;0.de.pool.ntp.org&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;serverport&quot;</span>: 123</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;mqtt&quot;</span>:</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;clientid&quot;</span>: <span class="stringliteral">&quot;xyz&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;brokerurl&quot;</span>: <span class="stringliteral">&quot;xyz.iot.eu-central-1.amazonaws.com&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;brokerport&quot;</span>: 8883</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></dd></dl>
</li>
<li>Go to IoT core after looging into <a href="http://console.aws.amazon.com/">http://console.aws.amazon.com/</a> The Home page will open as shown below</li>
</ol>
<div class="image">
<img src="AwsSendDataOverMqtt-1.png" alt="AwsSendDataOverMqtt-1.png"/>
<div class="caption">
Home Page for Aws</div></div>
<p>brokerurl can be get from Settings under Endpoint field </p><div class="image">
<img src="AwsSendDataOverMqtt-2.png" alt="AwsSendDataOverMqtt-2.png"/>
<div class="caption">
Brokerurl for the config.txt</div></div>
<h2><a class="anchor" id="XDK_AWS_SEND_DATA_OVER_MQTT_USER_GUIDE_SUBSECTION1"></a>
Steps to Generate certificate</h2>
<ol type="1">
<li>To create the certificate follow the below steps Go to IoT core page available under Internet of Things <ul>
<li>
<p class="startli">Go to Manage -&gt;Things </p><div class="image">
<img src="AwsSendDataOverMqtt-3.png" alt="AwsSendDataOverMqtt-3.png"/>
</div>
<p class="endli"></p>
</li>
<li>
<p class="startli">Create a Device under Things </p><div class="image">
<img src="AwsSendDataOverMqtt-4.png" alt="AwsSendDataOverMqtt-4.png"/>
</div>
<p class="endli"></p>
</li>
<li>
<p class="startli">Click on "Create a single thing" </p><div class="image">
<img src="AwsSendDataOverMqtt-5.png" alt="AwsSendDataOverMqtt-5.png"/>
</div>
<p class="endli"></p>
</li>
<li>
<p class="startli">Name your device under “Name” and click next </p><div class="image">
<img src="AwsSendDataOverMqtt-6.png" alt="AwsSendDataOverMqtt-6.png"/>
</div>
<p class="endli"></p>
</li>
<li>
<p class="startli">Creating certificate have two possibilities </p><ul>
<li>
For the newly created device <div class="image">
<img src="AwsSendDataOverMqtt-7.png" alt="AwsSendDataOverMqtt-7.png"/>
</div>
 </li>
<li>
If your device is already created then go to the created device for example XDK-Custom -&gt; Go to Security -&gt; create certificate <div class="image">
<img src="AwsSendDataOverMqtt-8.png" alt="AwsSendDataOverMqtt-8.png"/>
</div>
 &lt;&gt; </li>
<li>
Download the certificate and key 1,2 and 3 as per the image given below and afterwards click on Activate. If not activated then the device will not subscribe. So everytime the device should be activated when you flash the code&lt;<ul>
<li>&gt; <div class="image">
<img src="AwsSendDataOverMqtt-9.png" alt="AwsSendDataOverMqtt-9.png"/>
</div>
</li>
</ul>
</li>
<li>
<p class="startli">Downloaded certificates will be in .pem format which should be converted to .der format  After downloading the certificate -&gt; go to the place where it is saved -&gt; open git bash and use the command given below </p><div class="fragment"><div class="line">$ openssl x509 -outform der -in downloaded_cert.pem -out output.der -&gt; <span class="keywordflow">for</span> certificate (.cert.pem / root CA )</div>
<div class="line">$ openssl rsa -outform der -in key.pem -out <span class="keyword">private</span>.der -&gt; <span class="keywordflow">for</span> converting the <span class="keyword">private</span> key</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Downloaded_cert .pem is the downloaded file name and output .der which can be named anything. </dd>
<dd>
Save as a .pem in local system (Kindly remove space while saving the certificate) </dd></dl>
</li>
</ul>
<p class="endli"></p>
</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="XDK_AWS_SEND_DATA_OVER_MQTT_USER_GUIDE_SUBSECTION2"></a>
Steps to flash the application and see the data sent over Mqtt</h2>
<ol type="1">
<li>Modified the AppController.c file with the above modified certificate name <div class="fragment"><div class="line"><a class="code" href="group___a_w_s___s_e_n_d___d_a_t_a___o_v_e_r___m_q_t_t.html#ga4438dc180e055ef2bbd79104e360c8af">APP_ROOT_CA_FILE_NAME</a>- created by RSA 2048 bit key: VeriSign Class 3 Public Primary G5    root CA certificate <a class="code" href="_b_l_e_s_w-_a_l_p_w_data_exchange_01_release_notes_8txt.html#ac483df48653e4a0d787de0c45a6755b6">file</a> name</div>
<div class="line"><a class="code" href="group___a_w_s___s_e_n_d___d_a_t_a___o_v_e_r___m_q_t_t.html#ga66725ee15f7c0fb61690e21b9c2bda99">APP_PRIVATE_KEY_FILE_NAME</a> – created by Private Key <a class="code" href="_b_l_e_s_w-_a_l_p_w_data_exchange_01_release_notes_8txt.html#ac483df48653e4a0d787de0c45a6755b6">file</a> name</div>
<div class="line"><a class="code" href="group___a_w_s___s_e_n_d___d_a_t_a___o_v_e_r___m_q_t_t.html#ga467c9a1acd9f7679c9418c44ab15c97a">APP_CLIENT_CERT_KEY_FILE_NAME</a> –created by - A certificate <span class="keywordflow">for</span> <span class="keyword">this</span> thing (.pem.cert) <a class="code" href="_b_l_e_s_w-_a_l_p_w_data_exchange_01_release_notes_8txt.html#ac483df48653e4a0d787de0c45a6755b6">file</a> name</div>
</div><!-- fragment --></li>
<li>Place the generated certificates after converting to der format along with config.txt file in the SD Card and after modified as per point 4 compile and flash the Application, after the SNTP is success and the data can be seen in TeraTerm or in any console window <div class="image">
<img src="AwsSendDataOverMqtt-10.png" alt="AwsSendDataOverMqtt-10.png"/>
</div>
</li>
<li>Go to Test -&gt; and specify the topic for eg : “BCDS/XDK110/example/out” as mention in application and subscribe to the topic <div class="image">
<img src="AwsSendDataOverMqtt-11.png" alt="AwsSendDataOverMqtt-11.png"/>
</div>
</li>
<li>After subscribing you can see the data streaming as per the below picture <div class="image">
<img src="AwsSendDataOverMqtt-12.png" alt="AwsSendDataOverMqtt-12.png"/>
</div>
</li>
<li>Once the Application run the files in the SD card is converted to .bkp . The files can be modified again by placing the .der in the SD Card whichever file is required <div class="image">
<img src="AwsSendDataOverMqtt-13.png" alt="AwsSendDataOverMqtt-13.png"/>
</div>
 </li>
</ol>
</div></div><!-- contents -->
	<hr size="1" />
	All rights reserved. The use is subject to the XDK SDK EULA by Bosch Connected Devices and Solutions GmbH. 
	<hr size="1" />
	<address style="align: right;">
		<small>This documentation file has been automatically generated on Thu Mar 14 2019 19:12:49 by <a href="http://www.doxygen.org/index.html">doxygen</a> 1.8.8</small>
	</address>
</body>
</html>